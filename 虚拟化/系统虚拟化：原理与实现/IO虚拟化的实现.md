### 设备直接分配

设备直接分配的一个问题是如何阻止来自未分配到该设备的客户机的IO访问。

一个最直接的方法是隐藏。隐藏的方式根据具体情况而定，例如可以在拥有硬件设备的客户机/宿主机加载驱动程序前，先给要分配出去的设备加载一个伪驱动作为占位符。由于没有真正的设备驱动，该设备就不会被访问到。

### 设备IO地址空间的访问

PCI设备的IO地址空间通过PCI BAR（Base Address Register）报告给操作系统。为此，有两种选择供设备直接分配技术使用

- 将设备的真实PCI BAR报告给客户机，并通过VMCS的IO bitmap和EPT使客户机的端口IO和MMIO都不引起VM-Exit，则客户操作系统的驱动程序可以直接访问设备的IO地址空间。
- 建立转换表,报告虚拟的PCI BAR给客户机，当客户机访问到虚拟的IO地址空间时，VMM负责截获操作，并通过转换表把IO请求转发到设备的IO地址空间。

### 设备发现