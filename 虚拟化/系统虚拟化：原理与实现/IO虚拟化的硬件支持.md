评价IO虚拟化的两个指标--性能和通用性。

对于高性能，最直接的方法就是让客户机直接使用真实的硬件设备，这样客户机的IO操作路径几乎和无虚拟机环境下的IO路径相同。

对于通用性，就要用全虚拟化的方法，让客户机操作系统能够使用自带的驱动程序发现设备、操作设备。

VT-d技术通过在北桥引入DMA重映射硬件，以提供设备重映射和设备直接分配的功能。在启用VT-d的平台上，设备所有的DMA传输都被DMA重映射硬件截获。根据设备对应的IO页表，硬件可以对DMA中的地址进行转换，使设备只能访问到规定的内存。

### VT-d技术

#### DMA 重映射

在VT-d技术中，标识DMA操作发起者的结构称为源标识符。对与PCI总线，VT-d使用BDF作为源标识符。除了BDF外，VT-d还提供了两种数据结构来描述PCI架构，分别是根条目和上下文条目。

当DMA重映射硬件捕获一个DMA传输时，通过其中的BDF的bus字段索引根条目表，可以得到产生该DMA传输的总线对应的根条目。由根条目的CTP字段可以获得上下文条目表，用BDF中的{dev:func}索引该表，可以获得发起DMA传输的设备对应的上下文条目。从上下文条目的ASR字段，可以寻址到该设备对应的IO页表，此时，DMA重映射设备，并对它们的DMA传输进行地址转换。

#### IO页表

IO页表是DMA重映射硬件进行地址转换的核心。