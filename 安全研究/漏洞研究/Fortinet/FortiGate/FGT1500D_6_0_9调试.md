# tag

```
5cde7cc6da829cef8c195868c3b69b10
```

# 关键结构体大小

SSL 结构体大小(6224字节,0x1850):

```c
v2 = CRYPTO_zalloc(6224LL, "/Chroot_Build/9/SVN_REPO_CHILD/FortiOS/fortinet/migbase/openssl/ssl/ssl_lib.c", 682LL);
```

SSLConn结构体大小(1016字节)：

```c
v5 = sub_E55590(1LL, a4 + 1016LL);
```

http请求缓冲区大小（0x2000）：

```c
__int64 __fastcall sub_12B2370(__int64 a1, __int16 a2)
{
  __int64 v2; // rbx
  __int64 v3; // rax
  __int64 result; // rax

  v2 = sub_12AB940(a1, 168LL);
  *(_QWORD *)(v2 + 80) = a1;
  *(_DWORD *)(v2 + 48) = 0x2000;
  *(_DWORD *)v2 = a2 & 0x103;
  if ( (a2 & 1) != 0 )
  {
    *(_QWORD *)(v2 + 32) = sub_E55590(1LL, 0x2000LL);
```

# SSL 结构体关键字段偏移

init字段：0x64

handshake_func 字段偏移： 0x30

# sslvpnd 内存分配函数

用于ssl结构体内存申请的函数设置代码：

```c
..........................................................................................
  if ( !(unsigned int)CRYPTO_set_mem_functions(sub_1357D40, sub_1357D80, sub_1357D60) )
    sub_17945B0((unsigned int)"[sslvpnd:%d] CRYPTO_set_mem_functions() failed.\n", dword_3394538, v2, v3, v4, v5);
..........................................................................................
```

# 有用的脚本

```
handle SIGPIPE nostop
b *0x0000000000E46BC0 if (($rsi > 0x1000) && ($rsi < 0x3000))
commands
    printf "alloc size %d\n" , $rsi
    bt
    c
end
```

```
handle SIGPIPE nostop
b *SSL_new+0x33
commands
    silent
    printf "ssl struct alloc addr:%p\n",$rax
    c
end

handle SIGPIPE nostop
b *0x00000000012F0D6E
commands
    silent
    printf "enc data   alloc addr:%p\n",$rax
    c
end

handle SIGPIPE nostop
b *0x00000000012B243F
commands
    silent
    printf "recv buff  alloc addr:%p\n",$rax
    c
end
```
