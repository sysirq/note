# 现有信息整理

参考资料：Console Chaos: A Campaign Targeting Publicly Exposed Management Interfaces on Fortinet FortiGate Firewalls 中的Web management HTTPS activity疑似为该漏洞利用

描述如下：

与jsconsole活动在时间上密切相关，我们观察到来自一组VPS托管提供商IP地址的HTTPS流量。其中一些IP地址随后会建立到相同受损害防火墙的SSL VPN隧道。这些HTTPS事件发生在jsconsole活动之前数十秒。这一流量有几个值得注意的方面：

- Action was client-rst, which means that the client side of the TCP session has sent an RST packet to terminate the connection.
- The amount of data sent to the destination firewall was over a megabyte in size.
- The duration of the session was over 100 seconds.
- The app was “Web Management(HTTPS)”.
- The traffic originated from a WAN interface.

官网对该漏洞的描述如下：

An Authentication Bypass Using an Alternate Path or Channel vulnerability [CWE-288] affecting FortiOS and FortiProxy may allow a remote attacker to gain super-admin privileges via crafted requests to Node.js websocket module.


# 影响版本

7.0.0 <= FortiOS 7.0.* <= 7.0.16
7.0.0 <= FortiProxy 7.0.* <= 7.0.19
7.2.0 <= FortiProxy 7.2.* <= 7.2.12

# 分析

管理界面处理程序为node

```log
[node Web Authentication   - 1737352183 warn] - No authorization headers found. Authentication failed.
[node WebSocket            - 1737352183 error] - Authorization failed. Closing websocket.
```

```js
class WebSocketServer extends NodeServer
```

```js
/**
 * Websocket dispatcher. Takes websocket connections and instantiates the correct class after
 * validation
 */
class WebsocketDispatcher 
```

```js
/**
 * Singleton for performing authentication based on an HTTP request.
 */
class WebAuth 
```

httpclid

```
tcp        0      0 127.0.0.1:8023          0.0.0.0:*               LISTEN      177/httpclid
tcp        0      0 ::1:8023                :::*                    LISTEN      177/httpclid
```

# 成因

条件竞争

![image-20250328154754738](images/image-20250328154754738.png)

# 参考资料

Authentication bypass in Node.js websocket module

https://www.fortiguard.com/psirt/FG-IR-24-535

【已发现在野利用】FortiOS 和 FortiProxy 身份认证绕过漏洞(CVE-2024-55591)安全风险通告

https://mp.weixin.qq.com/s/3hrCLaMex7EEuJ9FUrG1CA

CVE-2024-55591: Fortinet Authentication Bypass Zero-Day Vulnerability Exploited in the Wild

https://www.tenable.com/blog/cve-2024-55591-fortinet-authentication-bypass-zero-day-vulnerability-exploited-in-the-wild

Console Chaos: A Campaign Targeting Publicly Exposed Management Interfaces on Fortinet FortiGate Firewalls

https://arcticwolf.com/resources/blog/console-chaos-targets-fortinet-fortigate-firewalls/

fortios-auth-bypass-check-CVE-2024-55591

https://github.com/watchtowrlabs/fortios-auth-bypass-check-CVE-2024-55591/blob/main/CVE-2024-55591-check.py