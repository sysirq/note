# 环境

FGT_VM64_KVM-v6-build0335-FORTINET.out.kvm.zip

cb609d431404bbf2a782c82cd317a2de43767c52c414b2f3f87e76e166393c61

# rootfs解压

未发现对rootfs在内核中做解压解密操作，正常gz文件

# 完整性检查

### 内核完整性检查

未发现

### 用户态完整性检查

存在完整性检查：

/bin/fips_self_test（sub_8065F0）--》sub_1CC46F0

```c
_BOOL8 __fastcall sub_1CC46F0(unsigned int a1)
{
  __int64 v1; // rax
  __int64 v2; // rbx
  _BOOL8 result; // rax
  char *v4; // [rsp+8h] [rbp-128h] BYREF
  char v5[268]; // [rsp+10h] [rbp-120h] BYREF
  __int16 v6; // [rsp+11Ch] [rbp-14h]
  char v7; // [rsp+11Eh] [rbp-12h]

  qmemcpy(v5, &off_2891EA8, sizeof(v5));
  v6 = 256;
  v7 = 0;
  v4 = v5;
  v1 = d2i_RSAPublicKey(0LL, &v4, 270LL);
  if ( v1 && (v2 = v1, !(unsigned int)sub_1CA4610("/data/rootfs.gz", "/data/rootfs.gz.chk", a1, v1)) )
    result = (unsigned int)sub_1CA4610("/data/flatkc", "/data/flatkc.chk", a1, v2) == 0;
  else
    result = 0LL;
  return result;
}
```

使其始终返回1即可

# sbin/init

```c
__int64 __fastcall main(__int64 a1, char **a2, char **a3)
{
  char *argv[2]; // [rsp+0h] [rbp-10h] BYREF

  sub_4013B0();//会读取/目录下的所有的文件的内容，计算sha256，然后保存在/.fgtsum中
  if ( (int)sub_401610("bin") >= 0 && (int)sub_401610("migadmin") >= 0 )
    sub_401610("usr");
  unlink("/sbin/xz");
  unlink("/sbin/ftar");
  argv[0] = "/bin/init";
  argv[1] = 0LL;
  execve("/bin/init", argv, 0LL);
  return 0LL;
}
```

