# 漏洞描述

RE11S v1.11 was discovered to contain a command injection vulnerability via the command parameter at /goform/mp.

# 固件下载

https://www.edimax.com/edimax/download/download/data/edimax/global/download/whole_home_wifi_system_ac1200_dual-band/re11s

# 固件分析

http:

```sh
$ file axhttpd 
axhttpd: ELF 32-bit LSB executable, MIPS, MIPS-II version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped
```

axhttpd:main.c 状态机？

```c
          while ( v45 > 0 && v48 )
          {
            v49 = v48[1];
            v50 = v48;
            v48 = (_DWORD *)*v48;
            if ( v49 == 1 && (((int)v66[v50[3] >> 5] >> (v50[3] & 0x1F)) & 1) != 0 )
            {
              v64 = read_post_data;
              --v45;
              if ( !v50[1677] )
                v64 = (int (__fastcall *)(int))procreadhead;
              v64((int)v50);
              v49 = v50[1];
            }
            if ( v49 == 2 && (((int)v66[(v50[3] >> 5) + 32] >> (v50[3] & 0x1F)) & 1) != 0 )
            {
              procsendhead((int)v50);
              v49 = v50[1];
              --v45;
            }
            if ( v49 == 3 && (((int)v66[v50[4] >> 5] >> (v50[4] & 0x1F)) & 1) != 0 )
            {
              procreadfile((int)v50);
              v49 = v50[1];
              --v45;
            }
            if ( v49 == 4 && (((int)v66[(v50[3] >> 5) + 32] >> (v50[3] & 0x1F)) & 1) != 0 )
            {
              procsendfile((int)v50);
              --v45;
            }
          }
```

axhttpd源代码：https://code.stanford.edu/plevis/ee185/-/blob/1191b565069111dc478207fb2d3dfc899b899ae2/software/firmware/circuitpython-main/lib/axtls/httpd/axhttpd.c

疑似最后会调用cgi:

```c
    v25[0] = (int)"/usr/bin/cgi";
    v25[1] = a1 + 28;
    v25[2] = 0;
    sprintf(v26, "SERVER_SOFTWARE=%s", "axhttpd/1.4.9");
    strcpy(v27, "DOCUMENT_ROOT=../www");
    snprintf(&v28, 256, "SERVER_NAME=%s", (const char *)(a1 + 796));
    v11 = 443;
    if ( !*(_BYTE *)(a1 + 5152) )
      v11 = 80;
    sprintf(&v29, "SERVER_PORT=%d", v11);
    snprintf(&v30, 256, "REQUEST_URI=%s", (const char *)(a1 + 5680));
    snprintf(&v31, 256, "SCRIPT_NAME=%s", (const char *)(a1 + 284));
    snprintf(&v32, 256, "PATH_INFO=%s", (const char *)(a1 + 5936));
    snprintf(&v33, 256, "QUERY_STRING=%s", (const char *)(a1 + 6192));
    snprintf(&v34, 256, "REMOTE_ADDR=%s", (const char *)(a1 + 5424));
    snprintf(&v35, 256, "HTTP_COOKIE=%s", (const char *)(a1 + 6448));
    ..................
    execve(v17, v25, v38);
```

# 漏洞分析

/web/mp.asp

```asp
<head>
<style>body { color: #333333; font: 9pt/18px "Monospace";font-weight:bold; }</style>
<script type="text/javascript" src="/file/javascript.js"></script>
</head>
<body>
<form action="/goform/mp" method="POST" name="mp">
<input type="text" name="command" value="">&nbsp;<input type="submit" value="GO">
<input type="hidden" name="getID" value="">&nbsp;
<input type="hidden" name="getID" value="">&nbsp;
</form>
<font color="red">V1.01</font><br>
<font color="red">#&nbsp;
</body><script type="text/javascript">document.mp.command.focus()</script>
```