# 环境搭建

版本：FortiManager_7_4_4

### 创建log磁盘

```
qemu-img create -f qcow2 data.qcow2 30G
```

### 挂在qcow2 文件

```
sudo modprobe nbd max_part=8
sudo qemu-nbd --connect=/dev/nbd0 path_to_your.qcow2
sudo fdisk -l /dev/nbd0
sudo mount -o ro /dev/nbd0p1 /mnt/

sudo umount /mnt
sudo qemu-nbd --disconnect /dev/nbd0
```

### 当第一次登录

用户为admin，密码为空

第一次登录时，会要求设置密码，我们将其设置为1234

# 内核解压

```
sysirq@sysirq-machine:~/Work/Fortinet/FortiManager_7_4_4/kernel$ vmlinux-to-elf vmlinuz vmlinux
Traceback (most recent call last):
  File "/home/sysirq/.local/bin/vmlinux-to-elf", line 63, in <module>
    ElfSymbolizer(
  File "/home/sysirq/.local/lib/python3.10/site-packages/vmlinux_to_elf/elf_symbolizer.py", line 44, in __init__
    kallsyms_finder = KallsymsFinder(file_contents, bit_size)
  File "/home/sysirq/.local/lib/python3.10/site-packages/vmlinux_to_elf/kallsyms_finder.py", line 177, in __init__
    self.find_linux_kernel_version()
  File "/home/sysirq/.local/lib/python3.10/site-packages/vmlinux_to_elf/kallsyms_finder.py", line 225, in find_linux_kernel_version
    raise ValueError('No version string found in this kernel')
ValueError: No version string found in this kernel
```

失败？？？？？？？看了下vmlinuz，貌似很难像fgt那样定位到调用extract_kernel的地方。extract_kernel还好定位，根据字符串“Destination physical address”，即可定位。

# 资料

Fortinet Confirms Exploitation of Critical FortiManager Zero-Day Vulnerability

https://www.infosecurity-magazine.com/news/fortinet-exploitation-fortimanager/

Missing authentication in fgfmsd

https://www.fortiguard.com/psirt/FG-IR-24-423

FGFM - FortiGate to FortiManager Protocol

https://docs.fortinet.com/document/fortigate/6.4.0/ports-and-protocols/373486/fgfm-fortigate-to-fortimanager-protocol

Communications Protocol Guide

https://fortinetweb.s3.amazonaws.com/docs.fortinet.com/v2/attachments/6379fbaa-6dda-11ee-a142-fa163e15d75b/FGFM-7.4-Communications_Protocol_Guide.pdf

Burning Zero Days: FortiJump FortiManager vulnerability used by nation state in espionage via MSPs

https://doublepulsar.com/burning-zero-days-fortijump-fortimanager-vulnerability-used-by-nation-state-in-espionage-via-msps-c79abec59773

Critical FortiManager 0-day under active exploitation (CVE-2024-47575)

https://www.mnemonic.io/resources/blog/advisory-critical-fortimanager-0-day-under-active-exploitation-cve-2024-47575/

Fortijump-Exploit-CVE-2024-47575

https://github.com/watchtowrlabs/Fortijump-Exploit-CVE-2024-47575