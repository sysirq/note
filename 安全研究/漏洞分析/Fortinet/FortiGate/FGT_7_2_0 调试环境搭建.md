# 环境搭建

### 创建log磁盘

```
qemu-img create -f qcow2 data.qcow2 30G
```

### 挂载qcow2 文件

```
sudo modprobe nbd max_part=8
sudo qemu-nbd --connect=/dev/nbd0 path_to_your.qcow2
sudo fdisk -l /dev/nbd0
sudo mount -o ro /dev/nbd0p1 /mnt/

sudo umount /mnt
sudo qemu-nbd --disconnect /dev/nbd0
```

### 内核解压

```
vmlinux-to-elf flatkc flatkc.elf
```

# 完整性检测

### 内核完整性检测

kernel_init --> init_post_isra_0 --> fgt_verify 会对/sbin/init进行完整性检查,需要将其返回0

```py
import idc
import idaapi
import idautils

data = idaapi.get_bytes(0xFFFFFFFF80803130, 10)
key = idaapi.get_bytes(0xFFFFFFFF8080324E, 4)

xor_result = bytes([byte ^ key[i % len(key)] for i, byte in enumerate(data)])

for b in xor_result:
    print(chr(b),end='')
```