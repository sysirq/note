# 虚拟机下载

地址：https://support.fortinet.com/Download/VMImages.aspx

Select Platform 我们选择 KVM

解压FGT_VM:

```sh
unzip FGT_VM64_KVM-v7.6.0.F-build3401-FORTINET.out.kvm.zip
```

创建log 磁盘：

```sh
qemu-img create -f qcow2 data.qcow2 30G
```

生成uuid：

```
sysirq@sysirq-machine:~/Work/Fortinet/FortiGate$ cat /proc/sys/kernel/random/uuid
e2d8d9d7-a25d-44be-93b5-97ffb52a51b0
```

虚拟机启动命令：

```bash
#/bin/bash

qemu-system-x86_64              -machine pc-i440fx-2.8 \
                                --accel kvm \
                                -m 2G \
                                -netdev tap,id=nc0,ifname=tap4fun,script=no,downscript=no \
                                -device virtio-net,netdev=nc0,mac=E0:35:0E:EE:A0:C0 \
                                -blockdev driver=file,node-name=hdafile,filename=fortios.qcow2 \
                                -blockdev driver=qcow2,file=hdafile,node-name=hda   \
                                -device virtio-blk,drive=hda  \
                                -blockdev driver=file,node-name=hdbfile,filename=data.qcow2 \
                                -blockdev driver=qcow2,file=hdbfile,node-name=hdb   \
                                -device virtio-blk,drive=hdb  \
                                -uuid e2d8d9d7-a25d-44be-93b5-97ffb52a51b0 \
                                -vnc 10.4.21.2:0

```

**Select Network to configure or add more network interfaces. The Device type must be Virtio.**

默认用户名：admin ， 密码为空

首次登录会要求你设置登录密码（方便期间，我设置为1234）

# 帮组信息获取

输入? , 可以获取命令提示。

输入特定命令后，在输入？，获取特定命令的帮助，eg: execute ?

# 网络配置

获取网卡信息：

```
get hardware nic port1
```

CLI 配置网络：

### 配置静态IP地址

```
config system interface
edit port1
set mode static
set ip 192.168.182.188 255.255.255.0
set allowaccess ping http https ssh
end
```

查看interfaces:

```
show system interface port1
```

### 配置默认路由

```
config router static
edit 1
set gateway 192.168.182.1
set device port1
end
```

查看路由配置：

```
show router static
```

### 配置DNS服务器

```
config system dns
set primary 8.8.8.8
set secondary 8.8.4.4
end
```

查看DNS配置

```
show system dns
```

之后，可以通过：192.168.182.188 访问Web管理页面，也可以通过ssh对其进行管理。

# 虚拟机永久试用许可证

版本：7.6.0

新部署的FortiGate-VM不再具有有效的评估许可证，即使该实例只有1个CPU和2 GB内存。执行命令get sys stat，输出结果如下:

```
Version: FortiGate-VM64 v7.4.4,buildXXXX,220715 (interim)
...
Serial-Number: FGVMEVNXFLTGKOBC
License Status: Invalid
VM Resources: 1 CPU/1 allowed, 2007 MB RAM/2048 MB allowed
```

从FortiCare获取虚拟机永久试用license:

```
execute vm-license-options account-id xxxx@fortinet.com
execute vm-license-options account-password xxxxxxx
execute vm-license
This VM is using the evaluation license. This license does not expire.
Limitations of the Evaluation VM license include:
  1.Support for low encryption operation only
  2.Maximum of 1 CPU and 2GiB of memory
  3.Maximum of three interfaces, firewall policies, and routes each
  4.No FortiCare Support
This operation will reboot the system !
Do you want to continue? (y/n)y

Connection to 10.6.30.74 closed.
```

# 命令行

- 输入**tree**显示整个FortiOS CLI命令树
- tree execute
- 可以使用grep提取特定信息，eg 提取网卡驱动：get hardware nic port1 | grep Driver 



### 排错命令

- diagnose hardware sysinfo vm full : 显示激活状态以及UUID
- get sys stat :   显示整体状态
  



# 资料

Configuring Network Settings using the CLI

https://help.fortinet.com/fdb/5-0-0/html/source/tasks/t_network_configuration_cli.html

Administration Guide

https://docs.fortinet.com/document/fortigate/7.4.4/administration-guide/498634/using-the-cli

Permanent trial mode for FortiGate-VM

https://docs.fortinet.com/document/fortigate/7.4.4/administration-guide/441460

KVM Administration Guide

https://docs.fortinet.com/document/fortigate-private-cloud/7.4.0/kvm-administration-guide/706376/about-fortigate-vm-on-kvm

Error downloading license: Invalid serial number

https://community.fortinet.com/t5/Support-Forum/Error-downloading-license-Invalid-serial-number/m-p/251838

Technical Note: VM License activation

https://community.fortinet.com/t5/FortiGate/Technical-Note-VM-License-activation/ta-p/190534

VM license

https://docs.fortinet.com/document/fortigate/7.4.4/administration-guide/416169