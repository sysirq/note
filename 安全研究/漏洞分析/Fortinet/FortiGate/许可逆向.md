# 环境

版本：FGT_VM64_KVM-v7.2.8.M-build1639-FORTINET.out.kvm.zip

**用FortiCloud账号搞一个评估认证：**

```
FGVMEVK_DHXR4W10 # diagnose debug vm-print-license 
SerialNumber: FGVMEVK_DHXR4W10
CreateDate: Thu Aug 15 05:35:08 2024
UUID: 74be38104da04db1ad85caab45e9d853
Key: yes
Cert: yes
Key2: yes
Cert2: yes
Model: EVAL (1)
CPU: 1 
MEM: 2048
VDOM license:
  permanent: 2
  subscription: 0
```

```
Version: FortiGate-VM64-KVM v7.2.8,build1639,240313 (GA.M)
Security Level: 1
Firmware Signature: certified
Virus-DB: 1.00000(2018-04-09 18:07)
Extended DB: 1.00000(2018-04-09 18:07)
Extreme DB: 1.00000(2018-04-09 18:07)
AV AI/ML Model: 0.00000(2001-01-01 00:00)
IPS-DB: 6.00741(2015-12-01 02:30)
IPS-ETDB: 6.00741(2015-12-01 02:30)
APP-DB: 6.00741(2015-12-01 02:30)
FMWP-DB: 0.00000(2001-01-01 00:00)
INDUSTRIAL-DB: 6.00741(2015-12-01 02:30)
IPS Malicious URL Database: 1.00001(2015-01-01 01:01)
IoT-Detect: 0.00000(2022-08-17 17:31)
Serial-Number: FGVMEVK_DHXR4W10
License Status: Valid
VM Resources: 1 CPU/1 allowed, 1992 MB RAM/2048 MB allowed
Log hard disk: Available
Hostname: FGVMEVK_DHXR4W10
Operation Mode: NAT
Current virtual domain: root
Max number of virtual domains: 2
Virtual domains status: 1 in NAT mode, 0 in TP mode
Virtual domain configuration: disable
FIPS-CC mode: disable
Current HA mode: standalone
Branch point: 1639
Release Version Information: GA
FortiOS x86-64: Yes
System time: Wed Aug 14 22:37:52 2024
Last reboot reason: warm reboot
```

# 分析

根据get sys stat 命令，以及License Status:字符串  我们可以定位到函数sub_23B43D0：

```c
__int64 sub_23B8320()
{
  __int64 v0; // r12
  __int64 result; // rax
  int v2; // r9d
  __int64 v3[18]; // [rsp+0h] [rbp-90h] BYREF

  v3[15] = __readfsqword(0x28u);
  memset(v3, 0, 0x78uLL);
  v3[7] = (__int64)sub_23B43D0;
  puts("register system.status");
  v0 = add_sub_command("system", "status", &algn_2000801[9], 0LL);
  result = 0LL;
  if ( v0 )
  {
    sub_22E2CF0(v0, 16LL);
    add_command_desc(v0, 0, 4096LL, 0LL, (__int64)"System status.", v2);
    add_command_handler(v0, v3);
    return 1LL;
  }
  return result;
}
```

```c
__int64 __fastcall sub_23B43D0(__int64 a1, const char *a2)
{

  v82 = __readfsqword(0x28u);
  v3 = sub_2A84FD0();
  if ( nCfg_debug_zone )
  {
    setenv("TZ", nCfg_debug_zone + 17625152, 1);
    tzset();
  }
  sub_2A47650(v73, 128LL);
  sub_2731DC0(a2, "Version: %s\n", v73);
  v4 = sub_2A420D0();
  sub_2731DC0(a2, "Security Level: %d\n", v4);
  if ( (*(_BYTE *)(v3 + 1) & 2) == 0 && !(unsigned int)sub_2AA0750() )
  {
    v49 = (const char *)sub_2A44790();
    sub_2731DC0(a2, "Firmware Signature: %s\n", v49);
  }
  sub_2907A20(1LL, v72, 64LL);
  sub_2731DC0(a2, "Virus-DB: %s\n", v72);
  sub_2907A20(2LL, v72, 64LL);
  sub_2731DC0(a2, "Extended DB: %s\n", v72);
  sub_2907A20(3LL, v72, 64LL);
  sub_2731DC0(a2, "Extreme DB: %s\n", v72);
  sub_2907A20(32LL, v72, 64LL);
  sub_2731DC0(a2, "AV AI/ML Model: %s\n", v72);
  sub_2907A20(8LL, v72, 64LL);
  sub_2731DC0(a2, "IPS-DB: %s\n", v72);
  sub_2907A20(9LL, v72, 64LL);
  sub_2731DC0(a2, "IPS-ETDB: %s\n", v72);
  sub_2907A20(0LL, v72, 64LL);
  sub_2731DC0(a2, "APP-DB: %s\n", v72);
  sub_2907A20(36LL, v72, 64LL);
  sub_2731DC0(a2, "FMWP-DB: %s\n", v72);
  sub_2907A20(10LL, v72, 64LL);
  sub_2731DC0(a2, "INDUSTRIAL-DB: %s\n", v72);
  sub_2907A20(11LL, v72, 64LL);
  sub_2731DC0(a2, "IPS Malicious URL Database: %s\n", v72);
  sub_2907A20(33LL, v72, 64LL);
  sub_2731DC0(a2, "IoT-Detect: %s\n", v72);
  sub_2731DC0(a2, "Serial-Number: %s\n", nCfg_debug_zone + 4468);
  v5 = sub_2A9D900(a2);
  v6 = "No License";
  if ( v5 )
  {
    v6 = (const char *)*((unsigned int *)nCfg_debug_zone + 7123);
    switch ( *((_DWORD *)nCfg_debug_zone + 7123) )
    {
      case 0:
        sub_2905BD0();
        v6 = "Startup";
        break;
      case 1:
        v6 = "Cert Not Yet Valid" + 13;
        break;
      case 2:
        v6 = "Pending";
        if ( *((_DWORD *)nCfg_debug_zone + 7122) )
          v6 = "Warning";
        break;
      case 3:
        v64 = sub_2A9FFA0();
        v6 = "CRL Expired" + 4;
        if ( !v64 )
          goto LABEL_117;
        break;
      case 4:
        if ( *((_DWORD *)nCfg_debug_zone + 7122) )
        {
          v6 = "Cert Not Yet Valid" + 13;
          if ( *((_DWORD *)nCfg_debug_zone + 7126) )
            v6 = "Invalid Copy";
        }
        else
        {
LABEL_117:
          v6 = "OCSP Response Invalid" + 14;
        }
        break;
      case 5:
        v6 = "CRL Expired" + 4;
        break;
      case 6:
        v6 = "Grace Period";
        break;
      default:
        break;
    }
  }
  v7 = (__int64)"License Status: %s\n";
  v8 = (char *)a2;
  sub_2731DC0(a2, "License Status: %s\n", v6);
  ..............................
```

sub_2A9D900 --> sub_2A9CF70 ---> sub_2A9EDB0 疑似许可证验证：



### 首先读取/data/etc/vm.lic文件，当前内容为：

```
-----BEGIN FGT VM LICENSE-----
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
uccrHZZ/U6Y=
-----END FGT VM LICENSE-----
-----BEGIN CMS-----
MIIMiwYJKoZIhvcNAQcCoIIMfDCCDHgCAQExDzANBglghkgBZQMEAgMFADALBgkq
hkiG9w0BBwGgggjrMIII5zCCBM+gAwIBAgICIAMwDQYJKoZIhvcNAQELBQAwgaUx
CzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRIwEAYDVQQHEwlTdW5u
eXZhbGUxETAPBgNVBAoTCEZvcnRpbmV0MR4wHAYDVQQLExVDZXJ0aWZpY2F0ZSBB
dXRob3JpdHkxFTATBgNVBAMTDGZvcnRpbmV0LWNhMjEjMCEGCSqGSIb3DQEJARYU
c3VwcG9ydEBmb3J0aW5ldC5jb20wIBcNMjIwMjA0MTg1NzI4WhgPMjA1NjA1MjYw
MDAwMDBaMIGGMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTESMBAG
A1UEBwwJU3Vubnl2YWxlMREwDwYDVQQKDAhGb3J0aW5ldDEeMBwGA1UECwwVQ2Vy
dGlmaWNhdGUgQXV0aG9yaXR5MRswGQYDVQQDDBJmb3J0aW5ldC1zdWJjYTIwMDMw
ggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDAfW0Mnb4wMgg2p0tZFKcU
4WHFn75Rj9tAKFzwobFcU6AAiP+6t3nqRiVbdX7Vmta4C2uhX67G52ir8MR8tMB8
EZRNYmZARaIwaYLtm3VEUm3YU3AnL2D6h5rSSIgIEUF1KsjfQh41nRO/PzhtE2KJ
IWKKSuKCQY0xaA0/41xncinqQVOC1H4aDETZfKjX1I8nuj5Y1znpyY1YJMcrautR
ayh/+GgNcZw6PNbUG3Cyr31d2WkrKkfrrG9uIrHEZdwlahW0jLeIkLf82JVG5eFq
xGPVEsNEY7pCXhNYqTsvc2rUTsgM3pyyAlSjRW7IOrRys2SXNNsqw4HnbF5zZ5WG
dUSYIiWE+TzaeqTVAI7WytQTnYEyn2yyNauzkf6r2U8nxUKKLJav6+pxhqD7q2nG
AnWP2EjsUlMHsXq1AD+I4NobS9Pa3SnkOah+vWbKH5/bLyITbC8jIzad4ZPPZV+N
cfi+iJhKnVLMDXmytE2nBb3WDJeRdHb5BX0V7J4YJjxATs94iHeZXXg1sPZMc1bA
EyIDpmUlnPyyD8XhPT255gcRz4Oug4S0Bqz2wl87HQ8Zo4miGbOO4rMiVlIQrYDp
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
TlRGAQAMjxJcvNhgKIJb
-----END CMS-----
```

### 然后对-----BEGIN FGT VM LICENSE----- 到 -----END FGT VM LICENSE-----的部分进行base64解密

```python
#!/usr/bin/python3
import hashlib
import os
import base64
import rsa
import sys
import binascii
import hashlib
import struct
from rsa import transform, core
from Crypto.Cipher import AES
from Crypto import Random
from Crypto.Util.Padding import pad, unpad
from Crypto.PublicKey import RSA

base64_encoded_data = """
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
uccrHZZ/U6Y=
"""

base64_decoded_data = base64.b64decode(base64_encoded_data)

aes_key_len  = struct.unpack('<I', base64_decoded_data[:4])[0]
print(aes_key_len)
```

output：

```
64
```

### 调用函数sub_2A9EAF0获取公钥信息

```c
__int64 sub_2A9EAF0()
{
  __int64 v0; // rax
  char i; // dl
  char v2; // dl
  void *v4; // [rsp+0h] [rbp-20h] BYREF
  char v5[17]; // [rsp+Fh] [rbp-11h] BYREF

  *(_QWORD *)&v5[9] = __readfsqword(0x28u);
  strcpy(v5, "/urandom");
  if ( !dword_F8AD4E4 )
  {
    v0 = 1LL;
    for ( i = '/'; ; i = v5[v2 & 7] )
    {
      byte_48735DF[v0] ^= i;
      v2 = v0++;
      if ( v0 == 95 )
        break;
    }
    dword_F8AD4E4 = 1;
  }
  v4 = &unk_48735E0;
  return d2i_PUBKEY(0LL, &v4, 94LL);
}
```

IDA Python 脚本：

```python
import hashlib
import os
import idc
import idaapi
import idautils
from Crypto.Cipher import ChaCha20
from Crypto.PublicKey import RSA
from Crypto.Util.asn1 import DerSequence


def read_rsa_public_key(public_key_der): 
    # 从 DER 编码数据中加载 RSA 公钥       
    public_key = RSA.import_key(public_key_der)
    print("Public Key:")
    print(public_key.export_key().decode())

encrypt_data = idaapi.get_bytes(0x48735E0,94)
decrypt_data = b'';
key = bytes("/urandom", 'utf-8')

for i in range(94):
    decrypt_data += bytes([encrypt_data[i] ^ key[i&7]])
print(len(decrypt_data))
read_rsa_public_key(decrypt_data)
```

Output:

```
94
Public Key:
-----BEGIN PUBLIC KEY-----
MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAPEk9M+bkeKVkhvuSbvOLFqhraNgpcLM
BkqvHLtZTiiN4wfMDcho2gbETdazJ9ewg6PTWf+d3H8YDccJtUSAIMkCAwEAAQ==
-----END PUBLIC KEY-----
```

### 用公钥对base64解密的数据，解密

其中base64解密的数据的前4个字节为要解密数据的长度

```python
#!/usr/bin/python3
import hashlib
import os
import base64
import rsa
import sys
import binascii
import hashlib
import struct
from rsa import transform, core
from Crypto.Cipher import AES
from Crypto import Random
from Crypto.Util.Padding import pad, unpad

base64_encoded_data = """IAAAAAKRuIxjmNthgg8KSPoO5zn9eq9/pEUGn0GhBzVw1zYLUAAAAGudDDBYBHbv
IJeZkuZx6x3TppXDopE4T/q6GnhcIwM5+BLuCM6OuybViGlQptNJqDTZeL+kx209
edacYuju03gJ4pkxwh6RCNZQoLJKeeqG
"""

pem_public_key ="""-----BEGIN PUBLIC KEY-----
MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAPEk9M+bkeKVkhvuSbvOLFqhraNgpcLM
BkqvHLtZTiiN4wfMDcho2gbETdazJ9ewg6PTWf+d3H8YDccJtUSAIMkCAwEAAQ==
-----END PUBLIC KEY-----"""

def rsa_decrypt(encrypt_text):
    key = rsa.PublicKey.load_pkcs1_openssl_pem(pem_public_key)

    d = key.e
    n = key.n
    encrypt_text = binascii.a2b_hex(encrypt_text)
    num = transform.bytes2int(encrypt_text)
    decrypto = core.decrypt_int(num, d, n)
    out = transform.int2bytes(decrypto)
    return out

base64_decoded_data = base64.b64decode(base64_encoded_data)
rsa_decrypt_len  = struct.unpack('<I', base64_decoded_data[:4])[0]
print("rsa_decrypt_len",rsa_decrypt_len)

data = rsa_decrypt(base64_decoded_data[4:4+rsa_decrypt_len].hex())
```

# 一些有用的函数原型

### RSA_public_decrypt

RSA_public_decrypt 是 OpenSSL 库中的一个函数，用于使用 RSA 公钥解密数据

函数原型:

```c
int RSA_public_decrypt(int flen, const unsigned char *from, unsigned char *to, RSA *rsa, int padding);
```

参数说明:

- int flen: 输入数据的长度（字节数）。
- *const unsigned char from: 指向要解密的数据的指针。
- *unsigned char to: 指向存储解密后数据的缓冲区的指针。
- *RSA rsa: 指向 RSA 密钥结构体的指针，使用的公钥。
- int padding: 填充模式，通常是以下之一：
- - RSA_PKCS1_PADDING: 使用 PKCS#1 v1.5 填充。（1）
-	-	RSA_NO_PADDING: 无填充。（-1）
- -	RSA_PKCS1_OAEP_PADDING: 使用 PKCS#1 v2.0 OAEP 填充（推荐）。（4）

### AES_set_decrypt_key

AES_set_decrypt_key 函数是 OpenSSL 库中的一个函数，用于设置 AES（高级加密标准）解密操作的密钥。这个函数初始化了一个 AES_KEY 结构，该结构随后用于 AES 解密操作。

函数原型：

```c
int AES_set_decrypt_key(const unsigned char *userKey, const int bits, AES_KEY *key);
```

参数：

- userKey：指向原始密钥数据的指针（一个字节数组）。这个密钥的长度应与 bits 参数相匹配（128 位对应 16 字节，192 位对应 24 字节，256 位对应 32 字节）。
- bits：密钥的长度，单位是位。它应该是 128、192 或 256 之一，对应 AES 支持的密钥长度。
- key：指向 AES_KEY 结构的指针。该结构将由函数初始化，并在后续的 AES 解密操作中使用。

###  AES_cbc_encrypt

AES_cbc_encrypt 是 OpenSSL 库中的一个函数，用于在 CBC（Cipher Block Chaining）模式下进行 AES（Advanced Encryption Standard）加密或解密。CBC 是一种常见的加密模式，它在每个块的加密过程中结合了前一个块的密文，从而增加了加密的安全性。

函数原型：

```c
void AES_cbc_encrypt(const unsigned char *in, unsigned char *out, size_t length, const AES_KEY *key, unsigned char *ivec, const int enc);
```

参数：

- in: 输入数据的指针，指向要加密或解密的数据块。
- out: 输出数据的指针，用于存储加密或解密后的数据。应确保 out 的大小与 in 相同。
- length: 输入数据的长度，以字节为单位。这个长度必须是 AES 块大小的整数倍（通常是 16 字节）。
- key: 指向 AES_KEY 结构的指针，之前必须通过 AES_set_encrypt_key 或 AES_set_decrypt_key 进行初始化。
- ivec: 初始化向量 (IV)，是 CBC 模式下使用的一个数据块，它需要和 AES 块大小相同（16 字节）。在加密时，它的值会被修改以便用于解密时的连续加密块。
- enc: 指定是加密还是解密的标志。如果 enc 为 AES_ENCRYPT（1），则执行加密；如果为 AES_DECRYPT（0），则执行解密。