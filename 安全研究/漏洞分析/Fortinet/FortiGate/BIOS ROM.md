对于固件的kernel格式显示为:

```
sysirq@sysirq-machine:~/Work/Fortinet/FortiGate_6_2_12/kernel$ file flatkc 
flatkc: BIOS (ia32) ROM Ext. (-86*512)
```

```
sysirq@sysirq-machine:~/Work/Fortinet/FortiGate_6_2_12/kernel$ xxd -l 1024 flatkc 
00000000: 55aa aa55 b000 0000 0002 0000 0000 0000  U..U............
00000010: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000020: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000030: 0000 1000 0000 0000 0000 0000 0000 0000  ................
00000040: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000050: 0000 0000 0000 0000 5400 0000 726f 2070  ........T...ro p
00000060: 616e 6963 3d35 2063 6f6e 736f 6c65 3d74  anic=5 console=t
00000070: 7479 5330 2c39 3630 3020 656e 6462 6173  tyS0,9600 endbas
00000080: 653d 3078 4130 3030 3020 6e6d 695f 7761  e=0xA0000 nmi_wa
00000090: 7463 6864 6f67 3d31 2072 6f6f 743d 2f64  tchdog=1 root=/d
000000a0: 6576 2f72 616d 3020 6e6f 2d68 6c74 2000  ev/ram0 no-hlt .
000000b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000000c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000000d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000000e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000000f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000100: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000120: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000130: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000140: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000150: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000160: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000170: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000180: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000190: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000001a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000001b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000001c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000001d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000001e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000001f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000200: 1f8b 0808 b2e5 6263 0403 666f 7274 696b  ......bc..fortik
00000210: 6572 6e65 6c2e 6f75 7400 ecfd 7b7c 54d5  ernel.out...{|T.
00000220: d9ff 8dcf 2419 4820 b8a3 120c 1635 68b0  ....$.H .....5h.
00000230: a0a2 4441 4921 9281 807b 7050 5454 14f5  ..DAI!...{pPTT..
00000240: 4623 947a 449d 013c e184 c910 b69b 41d4  F#.zD..<......A.
00000250: 7a68 ab15 4f15 b555 5b15 026a 4808 64c0  zh..O..U[..jH.d.
00000260: 6380 aa78 2420 e21e 460e 6a1b 1084 793e  c..x$ ..F.j...y>
00000270: d75a 3393 04ed ddef f7f7 7b3d cf5f 1f5a  .Z3.......{=._.Z
00000280: 337b afbd f63a bcd7 e95a d7ba d6da 7545  3{...:...Z....uE
00000290: 2e97 6bc1 c605 0d0b 5a0c 77a1 cb28 7095  ..k.....Z.w..(p.
000002a0: 3684 d714 1bc7 b7ae 70b9 8a70 b30c 7f5d  6.......p..p...]
000002b0: 3fbc a8ee a2b5 5d0b 5c2e abeb 0a57 4191  ?.....].\....WA.
000002c0: 4bdf 2ccb c1fb 5657 8f0b 0fc2 b15c 5ff0  K.,...VW.....\_.
000002d0: 8715 aee2 2257 5dd8 ed72 2d73 e5ea 67ae  ...."W]..r-s..g.
000002e0: e2d4 b33a 09d3 387e e3b2 90cb d560 9c6e  ...:..8~.....`.n
000002f0: 2c77 728d 4175 f01a 328e 6fd8 eeca 2a90  ,wr.Au..2.o...*.
00000300: 60f8 efff 4302 a50d baf0 17b4 2e70 0c57  `...C........p.W
00000310: 4b5d 31e2 365c 1be3 5b0f 18ff 1fa6 8251  K]1.6\..[......Q
00000320: 9100 0990 0009 9000 0990 0009 9000 0990  ................
00000330: c0ff fb04 4e73 b9c6 dfec 5ac8 7f24 4002  ....Ns....Z..$@.
00000340: 2440 0224 4002 2440 0224 4002 2440 0224  $@.$@.$@.$@.$@.$
00000350: 4002 2440 0224 4002 2440 0224 4002 2440  @.$@.$@.$@.$@.$@
00000360: 0224 4002 2440 0224 4002 2440 0224 4002  .$@.$@.$@.$@.$@.
00000370: 2440 0224 4002 2440 0224 4002 2440 0224  $@.$@.$@.$@.$@.$
00000380: 4002 2440 0224 4002 2440 0224 4002 2440  @.$@.$@.$@.$@.$@
00000390: 0224 4002 2440 0224 4002 2440 0224 4002  .$@.$@.$@.$@.$@.
000003a0: 2440 0224 4002 2440 0224 4002 2440 0224  $@.$@.$@.$@.$@.$
000003b0: 4002 2440 0224 4002 2440 0224 4002 2440  @.$@.$@.$@.$@.$@
000003c0: 0224 4002 2440 0224 4002 2440 0224 4002  .$@.$@.$@.$@.$@.
000003d0: 2440 0224 4002 2440 0224 4002 2440 0224  $@.$@.$@.$@.$@.$
000003e0: 4002 2440 0224 4002 2440 0224 4002 2440  @.$@.$@.$@.$@.$@
000003f0: 0224 4002 2440 0224 4002 2440 0224 4002  .$@.$@.$@.$@.$@.
```


- Two bytes indicate the beginning of an extension code section: 055h followed by 0AAh.
- Immediately following the two-byte preamble bytes is a third byte that gives the length of the additional BIOS. The number represents the amount of blocks 512 bytes long, needed to hold the extra code.


# 内核提取

```
dd if=flatkc of=fortikernel.out bs=1 skip=512
```

# 资料

BIOS Extension

https://flint.cs.yale.edu/feng/cos/resources/BIOS/biosextension.htm

Topic: updated rom-x86.trid.xml for BIOS ROM Extension (IA-32) + variants  (Read 1836 times)

https://mark0.net/forum/index.php?topic=883.0

Some Notes on ROM Extensions

https://www.rigacci.org/docs/biblio/online/firmware/romext.htm#:~:text=A%20ROM%20extension%20is%20a,which%20resides%20at%20C000%2DC7FF.

BIOS Articles

https://sites.google.com/site/pinczakko/bios-articles