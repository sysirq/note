# 关键结构体大小

ssl 结构体大小(6280字节 /  0x1888字节 , 会被分配到8KB的内存)：

```c
v2 = CRYPTO_zalloc(6280LL, "ssl/ssl_lib.c", 691LL);
```

http 请求缓冲区大小(0x2000字节):

```c
__int64 __fastcall sub_12E54D0(__int64 a1, __int16 a2)
{
  __int64 v2; // rbx
  __int64 v3; // rax
  __int64 result; // rax

  v2 = sub_12DE8F0(a1, 168LL);
  *(_QWORD *)(v2 + 80) = a1;
  *(_DWORD *)(v2 + 48) = 0x2000;
  *(_DWORD *)v2 = a2 & 0x103;
  if ( (a2 & 1) != 0 )
  {
    *(_QWORD *)(v2 + 32) = sub_E3D790(1LL, 0x2000uLL);
```

sconn结构体大小(1128字节/468字节)：

```c
__int64 __fastcall sub_13C8500(unsigned int a1, const __m128i *a2, char a3, int a4)
{
  __int64 v5; // rax
  __int64 v6; // rbx
  _QWORD *v7; // rax
  __int64 v8; // rdi
  __int64 v9; // rdi
  __m128i v10; // xmm0
  __int64 v11; // rax
  int v12; // er9
  int v13; // er11
  int v14; // er8
  unsigned int v15; // eax
  int v16; // esi
  __int64 v17; // rdx
  __int64 v18; // rcx
  int v19; // edi
  unsigned __int64 v20; // rax
  __int64 v21; // rdi
  char v23; // al
  bool v24; // al
  __int64 v25; // rax
  int *v26; // rax
  unsigned int v27; // eax
  void *v28; // rdi

  v5 = sub_E3D790(1LL, a4 + 1128LL);
```

# 内存分配函数

sub_E3D790   ：jemalloc

sub_12DE650 :  malloc_block



最底层的内存分配函数：

```c
void *__fastcall sub_E2F5C0(_QWORD *a1, __int64 a2, unsigned __int8 a3)
{
  unsigned __int64 v4; // r12
  void *v5; // rcx
  __int64 v6; // rdx
  __int64 v7; // rax

  v4 = (a2 + 4095) & 0xFFFFFFFFFFFFF000LL;
  v5 = (void *)sub_E2DDF0((__int64)a1, v4, 1u, 255LL, a3);
  if ( !v5 )
    return v5;
  v6 = a1[10];
  ++a1[7];
  ++a1[9];
  v7 = (v4 >> 7) - 32;
  a1[6] += v4;
  ++*(_QWORD *)(v7 + v6);
  ++*(_QWORD *)(v7 + a1[10] + 16);
  ++*(_QWORD *)(a1[10] + v7 + 24);
  if ( a3 )
    return v5;
  if ( byte_121ADE73 )
    return memset(v5, 0xA5, v4);
  if ( !byte_121ADE84 )
    return v5;
  return memset(v5, 0, v4);
}
```

# 有用的tips

### 0x00

CRYPTO_set_mem_functions 是 OpenSSL 中的一个函数，用于允许开发者自定义替换 OpenSSL 默认的内存分配、重新分配和释放函数

```c
int CRYPTO_set_mem_functions(
    void *(*m)(size_t),
    void *(*r)(void *, size_t),
    void (*f)(void *)
);
```

# 有用的gdb脚本

