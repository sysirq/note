# 调度类

调度类由 struct sched_class 表示

# 调度实体

调度实体由 struct sched_entity表示


# nice 值到 weight

通过查寻内核定义的表来转换。static const int prio_to_weight

```c
static const int prio_to_weight[40] = {
 /* -20 */     88761,     71755,     56483,     46273,     36291,
 /* -15 */     29154,     23254,     18705,     14949,     11916,
 /* -10 */      9548,      7620,      6100,      4904,      3906,
 /*  -5 */      3121,      2501,      1991,      1586,      1277,
 /*   0 */      1024,       820,       655,       526,       423,
 /*   5 */       335,       272,       215,       172,       137,
 /*  10 */       110,        87,        70,        56,        45,
 /*  15 */        36,        29,        23,        18,        15,
};
```

# nice 值到 inv_weight

```
static const u32 prio_to_wmult[40] = {
 /* -20 */     48388,     59856,     76040,     92818,    118348,
 /* -15 */    147320,    184698,    229616,    287308,    360437,
 /* -10 */    449829,    563644,    704093,    875809,   1099582,
 /*  -5 */   1376151,   1717300,   2157191,   2708050,   3363326,
 /*   0 */   4194304,   5237765,   6557202,   8165337,  10153587,
 /*   5 */  12820798,  15790321,  19976592,  24970740,  31350126,
 /*  10 */  39045157,  49367440,  61356676,  76695844,  95443717,
 /*  15 */ 119304647, 148102320, 186737708, 238609294, 286331153,
};
```

# 权重

每个调度实体都包含一个 struct load_weight 结构表示权重。

```c
struct load_weight {
	unsigned long weight;// 由nice值转换为来（查表）
	u32 inv_weight;// inverse weight，指权重倒转,,是 2^32/weight 的计算结果，这样做是方便用乘法计算虚拟时间。也是查表而来
};
```
该结构的初始化由 set_load_weight计算

# 虚拟时间的计算

由函数 calc_delta_fair计算。其结果如下：

```c
vruntime = (delta_exec*nice_0_weight)/weight
```

其中 vruntime 表示进程虚拟的运行时间,delta_exec表示实际的运行时间,nice_0_weight表示nice为0的权重值,weight表示该进程的权重值。

