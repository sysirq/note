SMP:在这样的系统中，所有的CPU在运行时，都是平等的。所有的CPU通过同一条总线共享同一个内存以及所有的外设。为了减少访问内存的冲突，SMP结构中的各个CPU通常都有自己的高速缓存。这样的结构适合于要求提高系统总的“吞吐量”，但是系统中的各个进程则相互独立的那些应用。

SMP结构存在的问题：
- 处理器间的同步与互斥
- 高速缓存与内存之间的一致性问题（存储类型及范围寄存器（MTRR））
- 中断处理问题

# SMP结构中的互斥问题

单纯的读或写本来就是原子的，问题在于一些既要读又要写，因而需要两个或两个以上的微操作才能完成的指令。对于这样的指令，i386 CPU提供了在指令执行期间对总线加锁的手段。CPU芯片上有一条引线LOCK，如果汇编语言的程序中在一条指令前面加上前缀“LOCK”，经过汇编以后的机器代码就使CPU在执行这条指令的时候把引线LOCK的电位拉低，从而把总线锁住，这样同一总线上别的CPU就暂时不能通过总线访问内存了。

高速缓存的使用可能会使实际的内存操作改变次序。从访问内存的角度看，这就使得CPU可能会有一些逻辑上已经完成、但是物理上尚未实现的内存操作。在SMP结构中，这种次序的改变也可能影响到CPU间的同步与互斥。所以，需要有一种手段，使得在某些操作之前把这种“欠下”的内存操作全都最终地、物理地完成，就好像把欠下来的债都结清，然后再开始新的活动一样。这种手段称为“内存路障”

- 凡是对系统总线加锁的操作都起着内存路障的作用。
- 一些特殊的指令和操作起着内存路障的作用。

mb()、rmb()、wmb()

对于现代的CPU，不同处理器对临界资源操作的互斥性和次序的正确性主要是靠硬件解决的，软件只起辅助的作用。

# 高速缓存与内存的一致性

Intel在Pentum CPU中为已经装入高速缓存的数据提供了一种自动与内存保持一致的机制，称为“窥探”(snooping)

高速缓存中的TLB部分，问题便有所不同。这个问题可以通过IPI、即“处理器间中断”来解决。

# SMP结构中的中断机制

8259A的作用是提供多个外部中断源与单一CPU之间的连接。

Intel设计了一种更为通用的中断控制器，称为“高级可编程中断控制器（APIC）”。

一般而言，集成在CPU芯片内部的本地APIC与外部IO APIC是配合使用的。

外部APIC可以把来自外部设备的中断请求提交系统中的各个CPU，每个CPU可以通过其内部APIC向其它CPU发出中断请求。